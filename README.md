# Medical Residency Match Simulation

This project is a Python-based simulation designed to analyze the medical residency matching process, with a specific focus on the impact of "signals" on match outcomes. It uses data from the National Resident Matching Program (NRMP) to model the behavior of applicants and programs. The simulation explores various scenarios and parameters to understand their effects on key metrics like the number of applications, match rates, and unfilled positions.

# Building and Running

## 1. Installation

Install the required Python packages using pip:

```bash
pip install -r requirements.txt
```

## 2. Generating Constants

The simulation's parameters are stored in a Parquet file located at `constants/constants.parquet`. This file is generated by the `create_constants.py` script. Before running the main simulation, you may need to generate or update this file.

To generate the constants, run the following command:

```bash
python constants/create_constants.py
```

This will create the `constants.parquet` file, which contains a variety of scenarios for the simulation. The script uses base data from `constants/nrmp_base_data.csv` and generates a range of simulation parameters using statistical distributions.

## 3. Running the Simulation

The main simulation script is `probabilistic_simulation.py`. To run the simulation, execute the script from the root directory of the project:

```bash
python probabilistic_simulation.py
```

The script will read the scenarios from `constants/constants.parquet`, run the simulations in parallel, and save the results to `results/probabilistic/results.csv`. The simulation is designed to be efficient, using multiple CPU cores to process the scenarios.

## 4. Visualizing the Results

The `probability_graphs.py` script can be used to generate visualizations from the simulation results. This script reads the data from `results/probabilistic/results.csv` and creates various plots to help analyze the outcomes.

To generate the graphs, run:

```bash
python probability_graphs.py
```

The output figures will be saved in the `figures/` directory.

# Project Structure

- **`probabilistic_simulation.py`**: The main entry point for running the simulations.
- **`probabilistic_simulation_helpers.py`**: Contains helper functions for the main simulation script.
- **`probability_graphs.py`**: Script for generating graphs from the simulation results.
- **`constants/`**: Stores the datasets and scripts used in the simulation.
  - **`create_constants.py`**: Script to generate the `constants.parquet` file.
  - **`nrmp_base_data.csv`**: Base data from NRMP used to generate simulation scenarios.
  - **`constants.parquet`**: The file containing all the simulation parameters (generated).
- **`results/`**: The default output directory for simulation results.
- **`figures/`**: The default output directory for generated graphs and plots.
- **`requirements.txt`**: Lists the Python dependencies for the project.

# Simulation Mechanics

The simulation operates through the following steps:

1.  **Initialization**: The main script initializes the simulation environment, reading the scenarios from `constants/constants.parquet`.
2.  **Scenario Execution**: For each scenario, the script runs a series of simulations in parallel. Each simulation involves:
    - **Applicant and Program Creation**: Applicants and programs are modeled as objects with specific attributes, including rankings and preferences.
    - **Application Process**: Applicants choose which programs to apply to, considering factors like program quality and signals.
    - **Interview Selection**: Programs review applications and invite a limited number of candidates for interviews, prioritizing signaled applications.
    - **Rank-Order Lists**: Both applicants and programs create rank-order lists based on their preferences.
    - **Matching Algorithm**: The simulation uses a stable matching algorithm, similar to the one used by the NRMP, to match applicants to programs.
3.  **Data Collection**: After each simulation, the script collects data on a wide range of outcomes, including:
    - Match rates for applicants.
    - The number of filled and unfilled positions at programs.
    - The effectiveness of signals in securing interviews and final matches.
    - The total number of applications reviewed by programs.
4.  **Results Storage**: The aggregated results from all simulations are stored in a CSV file at `results/probabilistic/results.csv` for further analysis.

# Key Assumptions

- The simulation is based on a simplified model of the residency match and does not capture all the complexities of the real-world process.
- Applicant and program preferences are primarily based on rankings, with signals providing an additional layer of preference.
- The number of interviews a program can offer is limited, creating a competitive environment for applicants.
- The simulation assumes that both applicants and programs act rationally to maximize their outcomes based on the available information.
